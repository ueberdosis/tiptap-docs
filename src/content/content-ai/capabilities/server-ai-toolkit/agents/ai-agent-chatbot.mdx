---
title: AI agent chatbot
meta:
  title: AI agent chatbot | Tiptap Content AI
  description: Build an AI agent that can read and edit Tiptap documents using the Server AI Toolkit API.
  category: Content AI
---

import { CodeDemo } from '@/components/CodeDemo'
import { Callout } from '@/components/ui/Callout'
import { Requirements, RequirementItem } from '@/components/Requirements'

<Requirements>
  <RequirementItem label="1. Get access">
    Access the Server AI Toolkit by purchasing the paid Server AI Toolkit add-on.{' '}
    <a href="https://tiptap.dev/contact-sales?form=server-ai-toolkit">Contact our team</a>.
  </RequirementItem>
  <RequirementItem label="2. Access the private registry">
    The Server AI Toolkit package is published in Tiptap's private npm registry. Authenticate to
    Tiptap's private npm registry by following the [setup guide](/guides/pro-extensions).
  </RequirementItem>
  <RequirementItem label="3. Install the package">
    Install the package from the private registry using npm or your preferred package manager.
  </RequirementItem>
</Requirements>

Build a simple AI agent chatbot that can read and edit Tiptap documents using the Server AI Toolkit cloud service.

<CodeDemo path="" isScrollable src="https://ai-toolkit-demos.vercel.app/server-ai-agent-chatbot" />

See the [source code on GitHub](https://github.com/ueberdosis/ai-toolkit-demos).

## Tech stack

- [React](https://react.dev/) + [Next.js](https://nextjs.org/)
- [AI SDK by Vercel](https://ai-sdk.dev/) + [OpenAI](https://openai.com/) models
- Server AI Toolkit API

## Installation

Create a [Next.js](https://nextjs.org/) project:

```bash
npx create-next-app@latest server-ai-agent-chatbot
```

Install the core Tiptap packages and the [Vercel AI SDK](https://ai-sdk.dev/) for OpenAI:

```bash
npm install @tiptap/react @tiptap/starter-kit ai @ai-sdk/react @ai-sdk/openai
```

Install the Server AI Toolkit package.

<Callout title="Pro package" variant="hint">
  The Server AI Toolkit is a pro package. Before installation, set up access to the private NPM
  registry by following the [private registry guide](/guides/pro-extensions).
</Callout>

```bash
npm install @tiptap-pro/server-ai-toolkit
```

## Get schema awareness data

First, get the schema awareness data from your Tiptap editor. This data describes the document structure and is required for all API calls.

```ts
// lib/get-schema-awareness.ts
import { Editor } from '@tiptap/core'
import { getSchemaAwarenessData } from '@tiptap-pro/server-ai-toolkit'

export function getSchemaAwareness(editor: Editor) {
  return getSchemaAwarenessData(editor)
}
```

## API endpoint

Create an API endpoint that uses the [Vercel AI SDK](https://ai-sdk.dev/) to call the OpenAI model. Get tool definitions from the Server AI Toolkit API and execute tools via the API:

```ts
// app/api/chat/route.ts
import { openai } from '@ai-sdk/openai'
import { createAgentUIStreamResponse, ToolLoopAgent, UIMessage, tool } from 'ai'

const API_BASE_URL = process.env.SERVER_AI_TOOLKIT_API_URL || 'https://api.tiptap.dev'
const JWT_TOKEN = process.env.SERVER_AI_TOOLKIT_JWT_TOKEN
const APP_ID = process.env.SERVER_AI_TOOLKIT_APP_ID

export async function POST(req: Request) {
  const {
    messages,
    schemaAwarenessData,
    document,
  }: {
    messages: UIMessage[]
    schemaAwarenessData: any
    document: any
  } = await req.json()

  // Get tool definitions from the Server AI Toolkit API
  const toolsResponse = await fetch(`${API_BASE_URL}/v2/toolkit/tools`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${JWT_TOKEN}`,
      'X-App-Id': APP_ID,
    },
    body: JSON.stringify({
      schemaAwarenessData,
    }),
  })

  const toolDefinitions = await toolsResponse.json()

  // Convert API tool definitions to AI SDK tool format
  const tools = Object.fromEntries(
    toolDefinitions.map((toolDef: any) => [
      toolDef.name,
      tool({
        description: toolDef.description,
        parameters: toolDef.inputSchema,
      }),
    ]),
  )

  const agent = new ToolLoopAgent({
    model: openai('gpt-4o'),
    instructions: 'You are an assistant that can edit rich text documents.',
    tools,
    async executeTool(toolCall) {
      // Execute tool via Server AI Toolkit API
      const response = await fetch(`${API_BASE_URL}/v2/toolkit/execute`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${JWT_TOKEN}`,
          'X-App-Id': APP_ID,
        },
        body: JSON.stringify({
          toolName: toolCall.toolName,
          input: toolCall.args,
          document,
          schemaAwarenessData,
        }),
      })

      const result = await response.json()

      // Update document if it changed
      if (result.docChanged && result.document) {
        document = result.document
      }

      return result.output
    },
    providerOptions: {
      openai: {
        reasoningEffort: 'minimal',
      },
    },
  })

  return createAgentUIStreamResponse({
    agent,
    uiMessages: messages,
  })
}
```

Configure your environment variables.

```sh
# .env
SERVER_AI_TOOLKIT_API_URL=https://api.tiptap.dev
SERVER_AI_TOOLKIT_JWT_TOKEN=your-generated-jwt-token
SERVER_AI_TOOLKIT_APP_ID=your-app-id
```

Get your App ID and secret key on the [Server AI Toolkit settings](https://cloud.tiptap.dev/v2/cloud/ai) page. Generate a JWT from the secret key for authentication.

## Client-side setup

Create a client-side React component that renders the Tiptap Editor and a simple chat UI. This component leverages the [useChat hook](https://ai-sdk.dev/docs/reference/ai-sdk-ui/use-chat) from the Vercel AI SDK to call the API endpoint and manage the chat conversation:

```tsx
// app/page.tsx
'use client'

import { DefaultChatTransport, lastAssistantMessageIsCompleteWithToolCalls } from 'ai'
import { useChat } from '@ai-sdk/react'
import { EditorContent, useEditor } from '@tiptap/react'
import StarterKit from '@tiptap/starter-kit'
import { useState, useEffect } from 'react'
import { getSchemaAwarenessData } from '@tiptap-pro/server-ai-toolkit'

export default function Page() {
  const editor = useEditor({
    immediatelyRender: false,
    extensions: [StarterKit],
    content: `<h1>AI agent demo</h1><p>Ask the AI to improve this.</p>`,
  })

  const [document, setDocument] = useState(editor?.getJSON() || null)

  // Update document state when editor content changes
  useEffect(() => {
    if (editor) {
      setDocument(editor.getJSON())
    }
  }, [editor])

  const { messages, sendMessage } = useChat({
    transport: new DefaultChatTransport({
      api: '/api/chat',
      body: {
        document: document || editor?.getJSON(),
        schemaAwarenessData: editor ? getSchemaAwarenessData(editor) : null,
      },
    }),
  })

  const [input, setInput] = useState('Replace the last paragraph with a short story about Tiptap')

  if (!editor) return null

  return (
    <div>
      <EditorContent editor={editor} />
      {messages?.map((message) => (
        <div key={message.id} style={{ whiteSpace: 'pre-wrap' }}>
          <strong>{message.role}</strong>
          <br />
          {message.parts
            .filter((p) => p.type === 'text')
            .map((p) => p.text)
            .join('\n')}
        </div>
      ))}
      <form
        onSubmit={(e) => {
          e.preventDefault()
          sendMessage({ text: input })
          setInput('')
        }}
      >
        <input value={input} onChange={(e) => setInput(e.target.value)} />
      </form>
    </div>
  )
}
```

## End result

With additional CSS styles, the result is a simple but polished AI chatbot application that uses the Server AI Toolkit to edit documents:

<CodeDemo path="" isScrollable src="https://ai-toolkit-demos.vercel.app/server-ai-agent-chatbot" />

See the [source code on GitHub](https://github.com/ueberdosis/ai-toolkit-demos).

## Next steps

- Learn more about the available tools in the [Agents section](/content-ai/capabilities/server-ai-toolkit/agents)
- Explore the [REST API reference](/content-ai/capabilities/server-ai-toolkit/api-reference/rest-api) for complete endpoint documentation
- Understand schema awareness with the [Schema awareness guide](/content-ai/capabilities/server-ai-toolkit/api-reference/schema-awareness)
