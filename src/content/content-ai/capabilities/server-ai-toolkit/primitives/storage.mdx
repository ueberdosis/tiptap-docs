---
title: Storage and document persistence
meta:
  title: Storage and document persistence | Tiptap Content AI
  description: Load and save documents after editing them with the Server AI Toolkit.
  category: Content AI
---

Load and save documents in Tiptap Cloud, or define a custom storage backend to store documents in your own database.

## `Storage` interface

The `ServerAiToolkitStorage` interface defines the contract for storage backends that can load and save documents.

### Methods

- **`getDocument()`**: `Promise<JSONContent>` - Retrieves the document from storage
- **`setDocument(document: JSONContent)`**: `Promise<void>` - Saves the document to storage

### Example

```typescript
import type { ServerAiToolkitStorage } from '@tiptap-pro/server-ai-toolkit'
import type { JSONContent } from '@tiptap/core'
import { db } from './db' // Your database client

class CustomStorage implements ServerAiToolkitStorage {
  async getDocument(): Promise<JSONContent> {
    // Load document from your database using db methods
    const doc = await db.getDocument('my-document')
    if (!doc) {
      throw new Error('Document not found')
    }
    return doc.content as JSONContent
  }

  async setDocument(document: JSONContent): Promise<void> {
    // Save document to your database using db methods
    await db.saveDocument('my-document', document)
  }
}
```

## `TiptapCloudStorage` class

Storage implementation that uses the Tiptap Collaboration REST API to retrieve and update documents on Tiptap Cloud.

### Configuration options (`TiptapCloudStorageOptions`)

- **`documentIdentifier`** (`string`): The Tiptap Cloud document identifier
- **`appId`** (`string`): The Tiptap Cloud application ID
- **`apiSecret`** (`string`): The API secret for authentication (from Tiptap Cloud dashboard settings)
- **`user?`** (`string`): Optional user ID to be associated with the change
- **`fragment?`** (`string | string[]`): Optional Yjs fragment to be updated. Defaults to `"default"`. Can be a single fragment or multiple fragments (e.g., `"a"` or `["a", "b"]`)
- **`baseUrl?`** (`string`): Optional base URL for the Tiptap Cloud API. Overrides the default URL constructed from `appId` (defaults to `https://${appId}.collab.tiptap.cloud`)

### Example

```typescript
import { TiptapCloudStorage } from '@tiptap-pro/server-ai-toolkit'

const storage = new TiptapCloudStorage({
  documentIdentifier: 'my-document',
  appId: process.env.TIPTAP_CLOUD_APP_ID,
  apiSecret: process.env.REST_API_SECRET,
  user: 'user-123',
  fragment: 'default',
})

const serverAiToolkit = getServerAiToolkit({
  storage,
  // ... other options
})
```

## `loadDocument`

Load a document from storage and update the toolkit's internal state.

### Parameters (`LoadDocumentOptions`)

- `updateState?` (`boolean`): Whether to update the local state with the document from storage. Default: `true`. If `false`, the method will return the updated document without updating the local state.

### Returns

`Promise<JsonNode>`: The loaded document as Tiptap JSON

### Example

```typescript
const toolkit = getServerAiToolkit({
  schemaAwarenessData,
  storage: new TiptapCloudStorage({
    documentIdentifier: 'my-document',
    appId: process.env.TIPTAP_CLOUD_APP_ID,
    apiSecret: process.env.REST_API_SECRET,
  }),
})

// Load document from storage
const document = await toolkit.loadDocument()

console.log(document)
// { type: 'doc', content: [...] }
```

### Load without updating state

```typescript
// Load document without updating the toolkit's state
const document = await toolkit.loadDocument({ updateState: false })

// The toolkit's internal document remains unchanged
```

## `saveDocument`

Save the current document to storage.

### Parameters

None

### Returns

`Promise<void>`

### Example

```typescript
// Edit the document
toolkit.setJson({
  type: 'doc',
  content: [{ type: 'paragraph', content: [{ type: 'text', text: 'Updated content' }] }],
})

// Save document to storage
await toolkit.saveDocument()
```

## `getStorage`

Get the current storage instance.

### Parameters

None

### Returns

`ServerAiToolkitStorage | null`: The storage instance or `null` if no storage is configured

### Example

```typescript
const storage = toolkit.getStorage()

if (storage) {
  console.log('Storage is configured')
}
```

## `setStorage`

Set or update the storage instance.

### Parameters

- `storage` (`ServerAiToolkitStorage | null`): The storage instance to use

### Returns

`void`

### Example

```typescript
// Set a new storage instance
toolkit.setStorage(
  new TiptapCloudStorage({
    documentIdentifier: 'another-document',
    appId: process.env.TIPTAP_CLOUD_APP_ID,
    apiSecret: process.env.REST_API_SECRET,
  }),
)

// Load from the new storage
await toolkit.loadDocument()
```

```typescript
try {
  await toolkit.loadDocument()
} catch (error) {
  console.error('Failed to load document:', error)
  // Handle error (e.g., document not found, network error)
}

try {
  await toolkit.saveDocument()
} catch (error) {
  console.error('Failed to save document:', error)
  // Handle error (e.g., validation error, network error)
}
```

## Next steps

- Learn about [storage options](/content-ai/capabilities/server-ai-toolkit/guides/storage)
- Explore [reading the document](/content-ai/capabilities/server-ai-toolkit/primitives/read-the-document)
- Explore [editing the document](/content-ai/capabilities/server-ai-toolkit/primitives/edit-the-document)
