---
title: Diff utility
meta:
  title: Diff utility | Tiptap Content AI
  description: Compute changes between two documents programmatically.
  category: Content AI
---

import { Callout } from '@/components/ui/Callout'

## `diffUtility`

Compares two documents and returns a list of changes between them.

### Supported formats

The Diff Utility can be used to compare entire documents or parts of them.

To compare entire documents, you can provide them in [Tiptap JSON format](/editor/core-concepts/introduction#content) or as a [ProseMirror Node](https://prosemirror.net/docs/ref/#model.Node).

To compare parts of the document, you can provide them as a Tiptap JSON fragment (a list of Tiptap JSON nodes) or as a [ProseMirror Fragment](https://prosemirror.net/docs/ref/#model.Fragment).

### Parameters (`DiffUtilityOptions`)

- `schema` (`Schema`): The ProseMirror schema used in the editor. Can be obtained from the editor instance: `editor.schema`
- `docA` (`Node | Fragment | JSONContent | JSONContent[]`): Original document. Can be a ProseMirror Node/Fragment or Tiptap JSON
- `docB` (`Node | Fragment | JSONContent | JSONContent[]`): Modified document. Can be a ProseMirror Node/Fragment or Tiptap JSON
- `simplifyChanges?` (`boolean`): Whether to simplify the changes so that if there are multiple changes in the same word, they are merged into one change. Does not apply when mode is 'block'. Default: `true`
- `ignoreAttributes?` (`string[]`): The attributes to ignore. Default: `['id', 'data-thread-id']`
- `ignoreMarks?` (`string[]`): The marks to ignore. Default: `['inlineThread']`
- `changeMergeDistance?` (`number | null`): Minimum length for an unchanged range to be considered significant. Unchanged ranges shorter than this value will be absorbed into adjacent changes, merging them into a single change. Set to `null` or `undefined` to use the auto-calculated default. Does not apply when mode is 'block'. Default: `8`
- `mode?` (`'smart' | 'inline' | 'block' | 'smartInline' | 'smartInlineV2'`): The diff mode to use for comparison.
  - `'smart'` uses tree-aware A\* pathfinding to align block nodes optimally, then applies character-level diff for inline content within matched blocks and recursive tree diff for nested block content. Changes never cut across block boundaries, producing clean diffs for structural document changes (default).
  - `'inline'` performs character-level diff that identifies precise changes within text.
  - `'block'` performs block-level diff that treats each top-level node as a single unit. Block mode is useful when you only need to know which paragraphs, headings, or other block-level elements have changed, without character-level detail. In block mode, `simplifyChanges` and `changeMergeDistance` options are ignored.
  - `'smartInline'` (deprecated, use `'smart'`) combines both approaches: first identifies changed blocks, then performs inline diff within those blocks.
  - `'smartInlineV2'` (deprecated, use `'smart'`) improves on `smartInline` by handling block elements (like tables) correctly.

<Callout title="Schema issue" variant="warning">
  Both documents must have the same schema. If the documents come from different editors, convert
  them to a common editor schema: `Node.fromJSON(editor.state.schema, otherEditor.getJSON())`
</Callout>

### Returns (`Change[]`)

Returns a list of changes. Each `Change` item contains:

- `rangeA` (`Range`): The range in the original document that has changed
- `rangeB` (`Range`): The range in the modified document that has changed

### Example

```ts
import { diffUtility } from '@tiptap-pro/ai-toolkit'

// Compute changes between two documents (uses 'smart' mode by default)
const changes = diffUtility({
  schema: editor.schema,
  docA,
  docB,
})

// Use block-level diffing
const blockChanges = diffUtility({
  schema: editor.schema,
  docA,
  docB,
  mode: 'block',
})

// Use inline (character-level) diffing
const inlineChanges = diffUtility({
  schema: editor.schema,
  docA,
  docB,
  mode: 'inline',
})
```
